
var cgen = require('./cgen');
var fs = require('fs');
var assert = require('assert');
var util = require('util');

describe('CodeGen', function() {
  it('should work', function() {
    var cg = new cgen.CodeGen('/tmp/cgen_test.h');
    var o = cg.withSubs({XXX: '37'});
    o.line('int test1() {');
    o.line('return 7 + XXX;');
    o.line('while (1) {}');
    o.line('foo(1,')
    o.line('2,3);');
    o.line('}');
    cg.end();

    var l = fs.readFileSync('/tmp/cgen_test.h', 'utf8');
    assert.ok(/define INCLUDE__tmp_cgen_test_h/.test(l));
    assert.ok(/Generated by/.test(l));
    assert.ok(/return 7 \+ 37/.test(l));
  });
});
